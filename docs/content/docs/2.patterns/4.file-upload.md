---
title: File Upload
description: Upload files with progress tracking and validation.
navigation:
  icon: i-lucide-upload
---

Convex stores files separately from your documents. You upload to Convex Storage, get back a storage ID, then save that ID in your database. This pattern shows you how.

## Backend Setup

First, create the server-side pieces: a mutation to generate upload URLs and a query to get file URLs.

```ts [convex/files.ts]
import { mutation, query } from './_generated/server'
import { v } from 'convex/values'

// Generate a URL for uploading
export const generateUploadUrl = mutation({
  handler: async (ctx) => {
    return await ctx.storage.generateUploadUrl()
  },
})

// Get a URL for viewing a file
export const getUrl = query({
  args: { storageId: v.id('_storage') },
  handler: async (ctx, args) => {
    return await ctx.storage.getUrl(args.storageId)
  },
})

// Delete a file
export const deleteFile = mutation({
  args: { storageId: v.id('_storage') },
  handler: async (ctx, args) => {
    await ctx.storage.delete(args.storageId)
  },
})
```

## Basic Upload

Use `useConvexFileUpload` to upload files with automatic progress tracking:

```vue
<script setup lang="ts">
const { upload, progress, pending, error } = useConvexFileUpload(
  api.files.generateUploadUrl
)

async function handleFileChange(event: Event) {
  const file = (event.target as HTMLInputElement).files?.[0]
  if (!file) return

  const storageId = await upload(file)
  console.log('Uploaded!', storageId)
}
</script>

<template>
  <div>
    <input type="file" @change="handleFileChange" :disabled="pending" />

    <div v-if="pending">
      Uploading: {{ progress }}%
    </div>

    <div v-if="error">
      {{ error.message }}
    </div>
  </div>
</template>
```

The `upload()` function returns the storage ID when complete. The `progress` ref updates during upload (0-100).

## With Validation

Add file type and size restrictions:

```ts
const { upload, progress, pending, error } = useConvexFileUpload(
  api.files.generateUploadUrl,
  {
    maxSize: 5 * 1024 * 1024, // 5MB
    allowedTypes: ['image/*', 'application/pdf'],
    onError: (err, file) => {
      console.error(`Failed to upload ${file.name}:`, err)
    },
  }
)
```

The `allowedTypes` array supports wildcards. `'image/*'` matches any image type.

## Upload and Save to Database

Usually you want to upload a file and then save its ID to a document:

```ts [convex/posts.ts]
export const create = mutation({
  args: {
    title: v.string(),
    content: v.string(),
    coverImageId: v.optional(v.id('_storage')),
  },
  handler: async (ctx, args) => {
    return ctx.db.insert('posts', {
      title: args.title,
      content: args.content,
      coverImageId: args.coverImageId,
      createdAt: Date.now(),
    })
  },
})
```

```vue
<script setup lang="ts">
const { upload, progress, pending } = useConvexFileUpload(
  api.files.generateUploadUrl
)
const { mutate: createPost } = useConvexMutation(api.posts.create)

const title = ref('')
const content = ref('')
const coverFile = ref<File | null>(null)

async function handleSubmit() {
  let coverImageId: Id<'_storage'> | undefined

  // Upload cover image if selected
  if (coverFile.value) {
    coverImageId = await upload(coverFile.value)
  }

  // Create post with storage ID
  await createPost({
    title: title.value,
    content: content.value,
    coverImageId,
  })
}
</script>
```

## Display Uploaded Files

Use `useConvexStorageUrl` to get a displayable URL from a storage ID:

```vue
<script setup lang="ts">
const props = defineProps<{ storageId: Id<'_storage'> }>()

const { url, pending } = useConvexStorageUrl(
  api.files.getUrl,
  computed(() => ({ storageId: props.storageId }))
)
</script>

<template>
  <div v-if="pending" class="skeleton" />
  <img v-else :src="url ?? undefined" />
</template>
```

The URL is reactive â€” if the storage ID changes, the URL updates.

## Progress Bar UI

A nicer upload experience with a progress bar:

```vue
<script setup lang="ts">
const { upload, progress, pending, error, cancel } = useConvexFileUpload(
  api.files.generateUploadUrl,
  {
    maxSize: 10 * 1024 * 1024,
    allowedTypes: ['image/*'],
  }
)

const selectedFile = ref<File | null>(null)
const uploadedId = ref<string | null>(null)

async function handleUpload() {
  if (!selectedFile.value) return

  try {
    const id = await upload(selectedFile.value)
    uploadedId.value = id
    selectedFile.value = null
  } catch (err) {
    // Error is also in error.value
  }
}
</script>

<template>
  <div class="upload-zone">
    <!-- File input -->
    <input
      type="file"
      accept="image/*"
      @change="(e) => selectedFile = (e.target as HTMLInputElement).files?.[0] ?? null"
      :disabled="pending"
    />

    <!-- Selected file info -->
    <div v-if="selectedFile && !pending" class="file-info">
      <span>{{ selectedFile.name }}</span>
      <button @click="handleUpload">Upload</button>
    </div>

    <!-- Progress -->
    <div v-if="pending" class="progress-container">
      <div class="progress-bar" :style="{ width: `${progress}%` }" />
      <span>{{ progress }}%</span>
      <button @click="cancel">Cancel</button>
    </div>

    <!-- Error -->
    <div v-if="error" class="error">
      {{ error.message }}
    </div>

    <!-- Success -->
    <div v-if="uploadedId" class="success">
      Uploaded successfully!
    </div>
  </div>
</template>

<style scoped>
.progress-container {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.progress-bar {
  height: 4px;
  background: #3b82f6;
  transition: width 0.2s;
}
</style>
```

## Drag and Drop

Add drag-and-drop support:

```vue
<script setup lang="ts">
const { upload, progress, pending } = useConvexFileUpload(
  api.files.generateUploadUrl
)

const isDragging = ref(false)

function handleDrop(e: DragEvent) {
  e.preventDefault()
  isDragging.value = false

  const file = e.dataTransfer?.files[0]
  if (file) {
    upload(file)
  }
}
</script>

<template>
  <div
    class="drop-zone"
    :class="{ dragging: isDragging }"
    @dragover.prevent="isDragging = true"
    @dragleave="isDragging = false"
    @drop="handleDrop"
  >
    <div v-if="pending">
      Uploading {{ progress }}%
    </div>
    <div v-else>
      Drop a file here or <label>browse<input type="file" @change="..." /></label>
    </div>
  </div>
</template>
```

## Multiple Files

Upload multiple files by calling `upload()` for each:

```ts
async function uploadMultiple(files: File[]) {
  const results = await Promise.all(
    files.map(file => upload(file))
  )
  return results // Array of storage IDs
}
```

For individual progress tracking per file, create separate `useConvexFileUpload` instances or track progress manually with XHR.
