---
title: Cheatsheet
description: Quick reference for all composables and patterns.
navigation:
  icon: i-lucide-file-text
---

Copy-paste snippets for common operations.

## Queries

```ts
// Basic query
const { data } = await useConvexQuery(api.posts.list, {})

// With SSR
const { data } = await useConvexQuery(api.posts.list, {}, { server: true })

// SSR + instant navigation
const { data } = await useConvexQuery(api.posts.list, {}, { server: true, lazy: true })

// Reactive args
const { data } = await useConvexQuery(api.posts.get, computed(() => ({ id: id.value })))

// Skip conditionally
const { data } = await useConvexQuery(api.posts.get, computed(() => id.value ? { id: id.value } : 'skip'))

// No real-time updates
const { data, refresh } = await useConvexQuery(api.posts.list, {}, { subscribe: false })

// With default value
const { data } = await useConvexQuery(api.posts.list, {}, { default: () => [] })

// Transform results
const { data } = await useConvexQuery(api.posts.list, {}, {
  transform: (posts) => posts.map(p => ({ ...p, date: new Date(p._creationTime) }))
})
```

## Query Return Values

```ts
const {
  data,      // Ref<T | null> - query result
  status,    // 'idle' | 'pending' | 'success' | 'error'
  pending,   // true while loading initial data
  error,     // Error | null
  refresh,   // () => Promise<void> - re-run query
  clear,     // () => void - clear data
} = await useConvexQuery(api.posts.list, {})
```

## Mutations

```ts
// Basic mutation
const { mutate } = useConvexMutation(api.posts.create)
await mutate({ title: 'Hello' })

// With optimistic update
const { mutate } = useConvexMutation(api.posts.create, {
  optimisticUpdate: (localStore, args) => {
    updateQuery({
      query: api.posts.list,
      args: {},
      localQueryStore: localStore,
      updater: (current) => [{ _id: 'temp', ...args }, ...(current ?? [])],
    })
  },
})

// Status tracking
const { mutate, pending, error, reset } = useConvexMutation(api.posts.create)
```

## Mutation Return Values

```ts
const {
  mutate,    // (args) => Promise<Result>
  data,      // Ref<Result | undefined> - last result
  status,    // 'idle' | 'pending' | 'success' | 'error'
  pending,   // true while running
  error,     // Error | null
  reset,     // () => void - clear data and error
} = useConvexMutation(api.posts.create)
```

## Optimistic Update Helpers

```ts
// Update a query result
updateQuery({
  query: api.todos.list,
  args: {},
  localQueryStore: localStore,
  updater: (current) => [...(current ?? []), newItem],
})

// Set query data directly
setQueryData({
  query: api.users.get,
  args: { id },
  localQueryStore: localStore,
  value: updatedUser,
})

// Delete from query
deleteFromQuery({
  query: api.todos.list,
  args: {},
  localQueryStore: localStore,
  shouldDelete: (item) => item._id === deletedId,
})

// Paginated: insert at top
insertAtTop({
  paginatedQuery: api.messages.list,
  localQueryStore: localStore,
  item: newMessage,
})

// Paginated: delete
deleteFromPaginatedQuery({
  paginatedQuery: api.messages.list,
  localQueryStore: localStore,
  shouldDelete: (msg) => msg._id === deletedId,
})
```

## Actions

```ts
const { execute, pending, error } = useConvexAction(api.email.send)
await execute({ to: 'user@example.com', subject: 'Hello' })
```

## Pagination

```ts
const { results, status, loadMore } = await useConvexPaginatedQuery(
  api.posts.list,
  {},
  { initialNumItems: 10 }
)

// Load more
loadMore(10)

// Status: 'LoadingFirstPage' | 'CanLoadMore' | 'LoadingMore' | 'Exhausted'
```

## Authentication

```ts
// Check auth state
const { isAuthenticated, isPending, user, token } = useConvexAuth()

// Sign in/out
const authClient = useAuthClient()
await authClient.signIn.email({ email, password })
await authClient.signUp.email({ name, email, password })
await authClient.signOut()
```

## Permissions

```ts
// In composables/usePermissions.ts
export const { usePermissions, usePermissionGuard } = createPermissions({
  query: api.auth.getPermissionContext,
  checkPermission: (ctx, permission, resource) => /* ... */,
})

// Usage
const { can, role } = usePermissions()
can('post.edit')           // Simple check
can('post.edit', post)     // With ownership check

// Guard a page
usePermissionGuard({ permission: 'settings.view', redirectTo: '/dashboard' })
```

## Connection State

```ts
const {
  isConnected,
  hasEverConnected,
  isReconnecting,
  connectionRetries,
  inflightMutations,
} = useConvexConnectionState()
```

## File Upload

```ts
const { upload, progress, pending, cancel } = useConvexFileUpload(
  api.files.generateUploadUrl,
  {
    maxSize: 5 * 1024 * 1024,
    allowedTypes: ['image/*'],
  }
)

const storageId = await upload(file)
```

## Server Utilities

```ts
// In server/api/*.ts
const data = await fetchQuery(api.posts.list, {})
const id = await fetchMutation(api.posts.create, { title: 'Hello' })
const result = await fetchAction(api.email.send, { to, subject })
```

## Config Options

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  convex: {
    url: process.env.CONVEX_URL,           // Required
    siteUrl: process.env.CONVEX_SITE_URL,  // For auth
    skipAuthRoutes: ['/blog/**'],          // Skip auth on routes
    permissions: true,                      // Enable permissions
    logging: { enabled: 'debug' },         // Enable logging
    authCache: { enabled: true, ttl: 900 }, // Cache tokens
  },
})
```

## Common Patterns

**Protected query (skip if not authenticated):**

```ts
const { isAuthenticated } = useConvexAuth()
const { data } = await useConvexQuery(
  api.user.profile,
  computed(() => isAuthenticated.value ? {} : 'skip')
)
```

**Loading states:**

```vue
<template>
  <div v-if="status === 'pending'">Loading...</div>
  <div v-else-if="status === 'error'">{{ error?.message }}</div>
  <div v-else-if="!data?.length">No items</div>
  <div v-else>
    <Item v-for="item in data" :key="item._id" :item="item" />
  </div>
</template>
```

**Auth middleware:**

```ts [app/middleware/auth.ts]
export default defineNuxtRouteMiddleware(() => {
  const { isAuthenticated, isPending } = useConvexAuth()
  if (isPending.value) return
  if (!isAuthenticated.value) return navigateTo('/login')
})
```

**Instant navigation with caching:**

```ts
const cached = useNuxtData(`post:${id}`)
const { data } = await useConvexQuery(api.posts.get, { id }, {
  server: true,
  lazy: true,
  default: () => cached.data.value,
})
```

## Decision Tree

**Which composable should I use?**

```
Need to fetch data?
├── One-time fetch → useConvexQuery with subscribe: false
├── Real-time updates → useConvexQuery
└── Paginated list → useConvexPaginatedQuery

Need to modify data?
├── Database write → useConvexMutation
└── External API call → useConvexAction

Need auth info?
├── Check if logged in → useConvexAuth
├── Sign in/out → useAuthClient
└── Check permissions → usePermissions

Need connection info?
└── useConvexConnectionState

Need to upload files?
└── useConvexFileUpload
```
